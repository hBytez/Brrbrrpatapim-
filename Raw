--== Local Functions and Variables ==--
local getinfo = getinfo or debug.getinfo
local DEBUG = false
local Hooked = {}

local Detected, Kill

setthreadidentity(2)

for i, v in getgc(true) do
    if typeof(v) == "table" then
        local DetectFunc = rawget(v, "Detected")
        local KillFunc = rawget(v, "Kill")
    
        if typeof(DetectFunc) == "function" and not Detected then
            Detected = DetectFunc
            
            local Old; Old = hookfunction(Detected, function(Action, Info, NoCrash)
                if Action ~= "_" then
                    if DEBUG then
                        warn(`Adonis AntiCheat flagged\nMethod: {Action}\nInfo: {Info}`)
                    end
                end
                return true
            end)
            table.insert(Hooked, Detected)
        end

        if rawget(v, "Variables") and rawget(v, "Process") and typeof(KillFunc) == "function" and not Kill then
            Kill = KillFunc
            local Old; Old = hookfunction(Kill, function(Info)
                if DEBUG then
                    warn(`Adonis AntiCheat tried to kill (fallback): {Info}`)
                end
            end)
            table.insert(Hooked, Kill)
        end
    end
end

local Old; Old = hookfunction(getrenv().debug.info, newcclosure(function(...)
    local LevelOrFunc, Info = ...
    if Detected and LevelOrFunc == Detected then
        if DEBUG then
            warn(`zins | adonis bypassed`)
        end
        return coroutine.yield(coroutine.running())
    end
    return Old(...)
end))
setthreadidentity(7)

--== Game Points/GUI Destruction ==--
if not game:IsLoaded() then
    game.Loaded:Wait()
end

spawn(function()
    while wait() do
        local player = game.Players.LocalPlayer
        local playerName = player.Name
        pcall(function()
            if game.ReplicatedStorage:FindFirstChild("Remotes") and game.ReplicatedStorage.Remotes:FindFirstChild("Events") and game.ReplicatedStorage.Remotes.Events:FindFirstChild("GameManager") then
                game.ReplicatedStorage.Remotes.Events.GameManager:Destroy()
            end
            if player.PlayerGui:FindFirstChild("Points") then
                player.PlayerGui.Points.Disabled = true
                if player.PlayerGui.Points:FindFirstChild("PointsCreator") then
                    player.PlayerGui.Points.PointsCreator.Disabled = true
                end
                player.PlayerGui.Points:Destroy()
            end
            if game:GetService("StarterGui"):FindFirstChild("Points") then
                game:GetService("StarterGui").Points.Disabled = true
            end
            if game:GetService("StarterGui"):FindFirstChild("PointsCreator") then
                game:GetService("StarterGui").PointsCreator.Disabled = true
            end
            if game:GetService("StarterGui"):FindFirstChild("Points") then
                game:GetService("StarterGui").Points:Destroy()
            end
        end)
    end
end)

--== Load Anti-Kick ==--
pcall(function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/Exunys/Anti-Kick/main/Anti-Kick.lua"))()
end)

--== In-game Notification ==--
local StarterGui = game:GetService("StarterGui")
StarterGui:SetCore("SendNotification", {
    Title = "KCR:Started",
    Text = "[KAROX COMBINED ANTI-CHEAT REMOVER IS ACTIVATED. PLEASE WAIT]",
    Icon = "",
    Duration = 7 -- seconds the notice will show
})
